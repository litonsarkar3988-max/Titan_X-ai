<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TITAN_X | Master Rahul</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --primary: #007AFF; --bg: #F2F2F7; --chat-bg: #FFFFFF; }
        body { background-color: var(--bg); font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 0; display: flex; justify-content: center; height: 100vh; }
        
        #app { 
            width: 100%; max-width: 500px; background: var(--chat-bg); 
            display: flex; flex-direction: column; box-shadow: 0 10px 30px rgba(0,0,0,0.05);
        }

        .header { 
            padding: 20px; background: white; border-bottom: 1px solid #E5E5EA;
            display: flex; align-items: center; gap: 12px;
        }
        .header .avatar { width: 40px; height: 40px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 20px; }
        .header h1 { font-size: 18px; margin: 0; color: #1C1C1E; }

        #messages { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 12px; }

        .msg { max-width: 80%; padding: 12px 16px; border-radius: 20px; font-size: 15px; line-height: 1.4; position: relative; }
        .bot { background: #E9E9EB; color: #1C1C1E; align-self: flex-start; border-bottom-left-radius: 4px; }
        .user { background: var(--primary); color: white; align-self: flex-end; border-bottom-right-radius: 4px; }

        .input-area { 
            padding: 15px 20px; background: white; border-top: 1px solid #E5E5EA;
            display: flex; align-items: center; gap: 10px; padding-bottom: 30px;
        }
        input { 
            flex: 1; border: 1px solid #E5E5EA; padding: 12px 20px; border-radius: 25px; 
            outline: none; font-size: 15px; background: #F2F2F7; transition: 0.2s;
        }
        input:focus { border-color: var(--primary); background: white; }

        .btn { border: none; background: none; cursor: pointer; font-size: 22px; transition: transform 0.2s; }
        .mic-btn { color: #8E8E93; }
        .mic-btn.active { color: #FF3B30; transform: scale(1.2); }
        .send-btn { color: var(--primary); }
        .btn:hover { transform: scale(1.1); }

        #login-screen { 
            position: absolute; inset: 0; background: white; z-index: 100;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .login-btn { 
            padding: 14px 30px; border-radius: 12px; border: none; 
            background: #1C1C1E; color: white; font-weight: 600; cursor: pointer;
        }
    </style>
</head>
<body>

<div id="app">
    <div id="login-screen">
        <div style="font-size: 50px; color: #007AFF; margin-bottom: 10px;"><i class="fas fa-circle-dot"></i></div>
        <h1 style="margin-bottom: 30px;">TITAN_X</h1>
        <button class="login-btn" onclick="login()">Google দিয়ে লগইন করুন</button>
    </div>

    <div class="header">
        <div class="avatar"><i class="fas fa-robot"></i></div>
        <div>
            <h1>TITAN_X</h1>
            <small style="color: #34C759;">Online</small>
        </div>
    </div>

    <div id="messages"></div>

    <div class="input-area">
        <button class="btn mic-btn" id="micBtn" onclick="startVoice()"><i class="fas fa-microphone"></i></button>
        <input type="text" id="userInput" placeholder="কিছু জিজ্ঞেস করুন...">
        <button class="btn send-btn" onclick="sendMsg()"><i class="fas fa-arrow-up-circle"></i></button>
    </div>
</div>

<script>
    // আপনার আগের Firebase Config এখানে থাকবে
    const firebaseConfig = {
        apiKey: "AIzaSyBFmq0OOzP4Pr66MepjqdO-LTU3v6x4cfE", 
        authDomain: "titan-x-ai.firebaseapp.com",
        projectId: "titan-x-ai",
        storageBucket: "titan-x-ai.firebasestorage.app",
        messagingSenderId: "8318559972",
        appId: "1:8318559972:web:93c76ed9e38d5807b72ef1"
    };
    firebase.initializeApp(firebaseConfig);

    function login() {
        const provider = new firebase.auth.GoogleAuthProvider();
        firebase.auth().signInWithPopup(provider);
    }

    firebase.auth().onAuthStateChanged(user => {
        if (user) {
            document.getElementById('login-screen').style.display = 'none';
            speak("নমস্কার মাস্টার রাহুল, আমি আপনাকে কীভাবে সাহায্য করতে পারি?");
        }
    });

    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = 'bn-BD';

    function startVoice() {
        recognition.start();
        document.getElementById('micBtn').classList.add('active');
    }

    recognition.onresult = (e) => {
        document.getElementById('userInput').value = e.results[0][0].transcript;
        document.getElementById('micBtn').classList.remove('active');
        sendMsg();
    };

    function speak(text) {
        const utter = new SpeechSynthesisUtterance(text);
        utter.lang = 'bn-BD';
        window.speechSynthesis.speak(utter);
    }

    async function sendMsg() {
        const input = document.getElementById('userInput');
        const text = input.value;
        if (!text) return;

        addMsg("আপনি", text, "user");
        input.value = "";

        try {
            const res = await fetch('https://titan-x-server.onrender.com/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: text })
            });
            const data = await res.json();
            
            if (data.image) {
                addMsg("TITAN_X", `<img src="${data.image}" style="width:100%; border-radius:12px; margin-top:8px;">`, "bot");
            }
            addMsg("TITAN_X", data.reply, "bot");
            speak(data.reply);
        } catch (err) {
            addMsg("সিস্টেম", "কানেকশন সমস্যা!", "bot");
        }
    }

    function addMsg(sender, msg, type) {
        const div = document.getElementById('messages');
        div.innerHTML += `<div class="msg ${type}">${msg}</div>`;
        div.scrollTop = div.scrollHeight;
    }
</script>
</body>
</html>
