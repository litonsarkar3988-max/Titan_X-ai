<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TITAN_X | Master Rahul</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --primary: #007AFF; --bg: #F2F2F7; }
        body { background: var(--bg); font-family: sans-serif; margin: 0; display: flex; justify-content: center; height: 100vh; }
        #app { width: 100%; max-width: 500px; background: white; display: flex; flex-direction: column; position: relative; }
        .header { padding: 15px; border-bottom: 1px solid #E5E5EA; display: flex; align-items: center; gap: 10px; }
        .header .dot { width: 10px; height: 10px; background: #34C759; border-radius: 50%; }
        #messages { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
        .msg { max-width: 80%; padding: 10px 15px; border-radius: 18px; font-size: 15px; line-height: 1.4; }
        .bot { background: #E9E9EB; color: black; align-self: flex-start; }
        .user { background: var(--primary); color: white; align-self: flex-end; }
        .input-area { padding: 15px; display: flex; gap: 10px; border-top: 1px solid #E5E5EA; }
        input { flex: 1; border: none; padding: 10px 15px; border-radius: 20px; background: #F2F2F7; outline: none; }
        .btn { border: none; background: none; font-size: 20px; cursor: pointer; color: var(--primary); }
        #login-screen { position: absolute; inset: 0; background: white; z-index: 10; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    </style>
</head>
<body>

<div id="app">
    <div id="login-screen">
        <h1 style="color: var(--primary);">TITAN_X AI</h1>
        <button onclick="login()" style="padding: 10px 20px; border-radius: 10px; border: none; background: #1C1C1E; color: white; cursor: pointer;">Google Login</button>
    </div>

    <div class="header">
        <div class="dot"></div>
        <h2 style="font-size: 18px; margin: 0;">TITAN_X (Online)</h2>
    </div>

    <div id="messages"></div>

    <div class="input-area">
        <button class="btn" id="micBtn" onclick="startVoice()"><i class="fas fa-microphone"></i></button>
        <input type="text" id="userInput" placeholder="কিছু লিখুন বা বলুন...">
        <button class="btn" onclick="sendMsg()"><i class="fas fa-paper-plane"></i></button>
    </div>
</div>

<script>
    // Firebase Config (একদম আগেরটাই থাকবে)
    const firebaseConfig = {
        apiKey: "AIzaSyBFmq0OOzP4Pr66MepjqdO-LTU3v6x4cfE", 
        authDomain: "titan-x-ai.firebaseapp.com",
        projectId: "titan-x-ai",
        storageBucket: "titan-x-ai.firebasestorage.app",
        messagingSenderId: "8318559972",
        appId: "1:8318559972:web:93c76ed9e38d5807b72ef1"
    };
    firebase.initializeApp(firebaseConfig);

    function login() {
        const provider = new firebase.auth.GoogleAuthProvider();
        firebase.auth().signInWithPopup(provider);
    }

    firebase.auth().onAuthStateChanged(user => {
        if (user) {
            document.getElementById('login-screen').style.display = 'none';
            speak("Welcome back Master Rahul!");
        }
    });

    // Voice Input
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = 'bn-BD';
    function startVoice() { recognition.start(); document.getElementById('micBtn').style.color = 'red'; }
    recognition.onresult = (e) => { 
        document.getElementById('userInput').value = e.results[0][0].transcript; 
        document.getElementById('micBtn').style.color = '#007AFF';
        sendMsg(); 
    };

    // Voice Output
    function speak(text) {
        window.speechSynthesis.cancel(); // আগের কথা থামিয়ে দেবে
        const utter = new SpeechSynthesisUtterance(text);
        utter.lang = 'bn-BD';
        window.speechSynthesis.speak(utter);
    }

    async function sendMsg() {
        const input = document.getElementById('userInput');
        const text = input.value;
        if (!text) return;

        addMsg("আপনি", text, "user");
        input.value = "";

        try {
            // আমি সরাসরি আপনার দেওয়া লিঙ্কটি এখানে বসিয়ে দিয়েছি
            const res = await fetch('https://titan-x-server.onrender.com/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: text })
            });
            const data = await res.json();
            
            addMsg("টাইটান", data.reply, "bot");
            speak(data.reply); // উত্তর মুখে বলবে
        } catch (err) {
            addMsg("সিস্টেম", "কানেকশন সমস্যা! সার্ভার চালু হতে ১০ সেকেন্ড সময় নিতে পারে।", "bot");
        }
    }

    function addMsg(sender, msg, type) {
        const div = document.getElementById('messages');
        div.innerHTML += `<div class="msg ${type}"><strong>${sender}:</strong><br>${msg}</div>`;
        div.scrollTop = div.scrollHeight;
    }
</script>
</body>
</html>
